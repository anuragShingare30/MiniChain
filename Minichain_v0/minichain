#!/bin/bash
#
# MiniChain v0 - Simple Node Launcher
# Usage:
#   ./minichain start 8000           # Start bootstrap node
#   ./minichain start 8001 8000      # Start peer connecting to port 8000
#   ./minichain clean                # Remove all wallet files
#

SCRIPT_DIR="$(cd "$(dirname "$0")" && pwd)"
cd "$SCRIPT_DIR"

# Activate virtual environment if exists
if [ -d "venv" ]; then
    source venv/bin/activate
fi

case "$1" in
    start)
        PORT="${2:-8000}"
        if [ -n "$3" ]; then
            python3 main.py --port "$PORT" --connect "localhost:$3"
        else
            python3 main.py --port "$PORT"
        fi
        ;;
    clean)
        rm -f wallet_*.key
        echo "âœ… All wallet files removed"
        ;;
    help|--help|-h|"")
        echo ""
        echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
        echo "â•‘              ğŸ”— MINICHAIN v0 LAUNCHER                  â•‘"
        echo "â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£"
        echo "â•‘                                                        â•‘"
        echo "â•‘  USAGE:                                                â•‘"
        echo "â•‘    ./minichain start <port> [connect_port]             â•‘"
        echo "â•‘    ./minichain clean                                   â•‘"
        echo "â•‘    ./minichain help                                    â•‘"
        echo "â•‘                                                        â•‘"
        echo "â•‘  EXAMPLES:                                             â•‘"
        echo "â•‘    ./minichain start 8000        # Bootstrap node      â•‘"
        echo "â•‘    ./minichain start 8001 8000   # Connect to 8000     â•‘"
        echo "â•‘    ./minichain start 8002 8000   # Another peer        â•‘"
        echo "â•‘                                                        â•‘"
        echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
        echo ""
        ;;
    *)
        echo "Unknown command: $1"
        echo "Run './minichain help' for usage"
        ;;
esac
